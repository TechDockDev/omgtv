# PocketLOL API Gateway Environment Variables
# Copy this file to .env and adjust values per environment.

# Runtime mode: development | test | production (set by gateway deployment config)
NODE_ENV=development

# HTTP server configuration (gateway defaults; adjust per environment)
SERVER_HOST=0.0.0.0
SERVER_PORT=3000
# Max inbound payload size in bytes (default 1 MiB)
SERVER_BODY_LIMIT=1048576
# Set to false if the gateway should not trust upstream proxies
SERVER_TRUST_PROXY=true

# Logging verbosity: fatal | error | warn | info | debug | trace
LOG_LEVEL=info
# Enable Fastify request logging in production (true/false)
ENABLE_REQUEST_LOGGING=false

# Redis connection string used for rate limiting and metadata cache
REDIS_URL=redis://localhost:6379

# Rate limiting tiers (requests per minute)
RATE_LIMIT_ANON=20
RATE_LIMIT_AUTH=100
RATE_LIMIT_ADMIN=500

# JWT verification settings sourced from Auth/IAM platform team
AUTH_JWKS_URL=http://auth-service:4000/.well-known/jwks.json
AUTH_AUDIENCE=pocketlol-services
AUTH_ISSUER=auth-service
# Seconds to cache JWKS keys locally
AUTH_CACHE_TTL_SECONDS=300

# Metadata cache TTL (seconds) for content lookups
CONTENT_CACHE_TTL_SECONDS=120

# CORS allow list (comma-separated origins). Leave empty to allow all during local dev.
CORS_ALLOWED_ORIGINS=http://localhost:3001,http://localhost:5173
# CDN hosts allowed in CSP directives (comma-separated)
CDN_ALLOWED_HOSTS=cdn.pocketlol.dev

# Downstream service base URLs (provided by service owners or service discovery)
STREAMING_SERVICE_URL=http://streaming-service:4900
CONTENT_SERVICE_URL=http://content-service:4600
AUTH_SERVICE_URL=http://auth-service:4000
USER_SERVICE_URL=http://user-service:4500
UPLOAD_SERVICE_URL=http://upload-service:5000
ENGAGEMENT_SERVICE_URL=http://engagement-service:4700
SEARCH_SERVICE_URL=http://search-service:4800
SUBSCRIPTION_SERVICE_URL=http://subscription-service:5100

# Optional bearer token for service-to-service authentication (must equal AuthService SERVICE_AUTH_TOKEN)
SERVICE_AUTH_TOKEN=change-me

# Observability (values supplied by observability/SRE team when collectors are available)
SERVICE_NAME=pocketlol-gateway
ENABLE_TELEMETRY=false
OTEL_EXPORTER_OTLP_ENDPOINT=https://otel-collector.pocketlol.dev:4318

# Route toggles (managed by gateway operations during rollouts)
# ROUTES_ENABLED=auth,content
# ROUTES_DISABLED=upload

# Override individual upstream endpoints (used for canaries/blue-green by gateway operations)
# SERVICE_ENDPOINT_OVERRIDES=streaming=https://streaming-canary.internal,content=https://content-v2.internal

# Audit event sink configuration (provided by compliance/security platform when enabled)
ENABLE_AUDIT_EVENTS=false
# AUDIT_EVENT_SINK_URL=https://audit-bus.pocketlol.dev/events
# AUDIT_EVENT_SINK_TOKEN=change-me
# AUDIT_EVENT_SINK_TIMEOUT_MS=2000
